# 가격과 틱(Tick)

## 가격 추적

Whirlpool은 가격의 제곱근(sqrt price)을 사용해 가격을 나타냅니다. 각 풀은 $[2^64, 2^-64]$ 범위의 제곱근 가격을 지원합니다.

## 틱

Whirlpool에서 사용자는 자신이 원하는 가격 범위에 유동성을 예치할 수 있습니다.
가격의 최소 단위인 틱은 1bp(0.01%)이며, Whirlpool은 가격 범위를 일련의 틱으로 표현하고 초기화된 각 틱에 유동성 계정을 저장합니다.

제곱근 가격과 틱은 다음 수식으로 매핑됩니다.

$$p(i) = 1.0001^i$$

각 틱은 이웃 틱 대비 1bp의 가격 변화를 의미합니다. 지원되는 가격 범위 $[2^{64}, 2^{-64}]$ 를 고려하면, Whirlpool의 틱 인덱스 범위는 $[-443,636, 443,636]$입니다.
Whirlpool 계정은 현재 제곱근 가격(sqrt price)와 현재 틱 인덱스(tick index)를 모두 추적합니다.

## 틱 간격 이해하기

계산 비용과 계정 렌트 제약 때문에, 모든 틱에 유동성을 허용하는 것은 비효율적입니다.
Whirlpool에서는 풀 소유자가 틱 간격(tick spacing) 파라미터를 정의하도록 요구합니다.
이 값은 초기화 가능한 틱(Initializable Ticks) 사이의 간격을 결정합니다.

예를 들어 틱 간격이 5라면, 유동성은 틱 인덱스가 5의 배수인 위치 (... -10, -5, 0, 5, 10...)에만 예치할 수 있습니다.

일반적으로 변동성이 낮을수록 틱 간격을 작게, 변동성이 높을수록 크게 설정하는 것이 좋습니다. 최적의 틱 간격을 고를 때 고려할 요소는 다음과 같습니다.

### 1. 가격 범위 세분성

틱 간격이 작을수록 사용자가 예치할 수 있는 가격 범위가 더 촘촘해집니다.
안정적인 풀의 경우, 세분화된 틱 간격을 통해 더 좁은 범위에 유동성을 집중시켜 레버리지를 극대화할 수 있습니다.

**틱 간격(Tick Spacing) = 1 인 경우**

| 가격                                   | 초기화 가능한 틱 인덱스 |
|----------------------------------------|-------------------------|
| $1.0001^{-2} = \frac{1}{1.00020001}$   | -2                      |
| $1.0001^{-1} = \frac{1}{1.0001}$       | -1                      |
| $1.0001^{0} = 1$                       | 0                       |
| $1.0001^{1} = 1.0001$                  | 1                       |
| $1.0001^{2} = 1.00020001$              | 2                       |

**틱 간격(Tick Spacing) = 100 인 경우**

| 가격                                                       | 초기화 가능한 틱 인덱스 |
|------------------------------------------------------------|-------------------------|
| $1.0001^{-200} = \frac{1}{1.0202003198939318}$             | -200                    |
| $1.0001^{-100} = \frac{1}{1.0100496620928754}$             | -100                    |
| $1.0001^{0} = 1$                                           | 0                       |
| $1.0001^{100} = 1.0100496620928754$                        | 100                     |
| $1.0001^{200} = 1.0202003198939318$                        | 200                     |

### 2. 스왑당 최대 가격 이동 폭

틱 간격의 크기는 한번의 스왑이 풀 가격을 얼마나 크게 이동시킬 수 있는지를 결정합니다.
- 틱 간격이 클수록 더 넓은 가격 범위를 한번에 넘나들 수 있습니다.
- 틱 간격이 작으면 큰 가격 변동 시 여러 번의 스왑이 필요할 수 있습니다.
- 따라서 변동성이 큰 페어는 더 큰 틱 간격을 고려하세요.

### 3. 계정 렌트 비용

온체인에 데이터를 저장하는데는 계정 공간을 사용하는데에 대한 비용이 발생하며, 데이터가 많을수록 렌트 비용이 증가합니다.

틱 간격을 크게 설정하면 동일한 가격 범위를 관리하는 데 필요한 틱의 수가 줄어들어 사용자 측 저장 비용을 절감할 수 있습니다.